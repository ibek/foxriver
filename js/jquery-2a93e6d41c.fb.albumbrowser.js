!function(t){t.fn.FacebookAlbumBrowser=function(e){var n=t.extend({},{account:"",accessToken:"",showAccountInfo:!0,showImageCount:!0,skipEmptyAlbums:!0,showComments:!0,commentsLimit:5,skipAlbums:[],includeAlbums:[],onlyAlbum:null,thumbnailSize:200,showAlbumNameInPreview:!0,lightbox:!0,photosCheckbox:!0,albumSelected:null,photoSelected:null,photoChecked:null,photoUnchecked:null,showImageText:!1,likeButton:!0,shareButton:!0,addThis:null,pluginImagesPath:"src/",albumsPageSize:0,albumsMoreButtonText:"Další alba...",photosPageSize:0,photosMoreButtonText:"Další fotky...",checkedPhotos:[],showMoreButton:!0},e),o=t(this),s="https://graph.facebook.com/",d="&fields=id,created_time,from,height,icon,images,link,name,picture,updated_time,width,source";return o.each(function(e){function l(e){t(v).addClass("fb-loading-image"),t.ajax({type:"GET",url:e,cache:!1,dataType:"jsonp",success:function(e){if(t(e.data).length>0){if(null!=n.albumsPageSize&&n.albumsPageSize>0){var c=t(b).find(".fb-btn-more");0==c.length&&(c=t("<div>",{class:"fb-btn-more fb-albums-more",lang:"cz",text:n.albumsMoreButtonText}),t(b).append(c),t(c).click(function(){var e=t(this);t(b).find("li.fb-album:hidden").slice(0,n.albumsPageSize).fadeIn(function(){0==t(b).find("li.fb-album:hidden").length&&e.fadeOut(function(){e.remove()})})}))}for(a=0;a<t(e.data).length;a++)if(!(n.skipAlbums.length>0&&(n.skipAlbums.indexOf(t(e.data).get(a).name)>-1||n.skipAlbums.indexOf(t(e.data).get(a).id.toString())>-1)||n.includeAlbums.length>0&&n.includeAlbums.indexOf(t(e.data).get(a).name)<0&&n.includeAlbums.indexOf(t(e.data).get(a).id.toString())<0)){var h=t("<li>",{class:"fb-album","data-id":t(e.data).get(a).id,style:"height:"+n.thumbnailSize+"px !important; width:"+n.thumbnailSize+"px !important"});if(null!=t(e.data).get(a).count||!n.skipEmptyAlbums){var u=t(e.data).get(a).cover_photo,m=s;void 0!==u&&(isNaN(u)?m+=u.id:m+=u),""!=n.accessToken&&(m+="?access_token="+n.accessToken+d),t.ajax({type:"GET",url:m,cache:!1,data:{album:t(e.data).get(a).id},dataType:"jsonp",success:function(e){var a=t("li.fb-album[data-id='"+function(t,e){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e);return null==a?"":decodeURIComponent(a[1].replace(/\+/g," "))}("album",t(this).get(0).url)+"'] ");if(!t(e).get(0).error&&t(e).get(0).images){var n=a.width(),o=a.height(),s=t(e.images)[0];for(i=0;i<t(e.images).length;i++)t(e.images)[i].height>=o&&t(e.images)[i].width>=n&&t(e.images)[i].height<=s.height&&t(e.images)[i].width<=s.width&&(s=t(e.images)[i]);var d=t("<img>",{style:"margin-left:"+(n-s.width)/2+"px; display:none;","data-id":t(e).get(0).id,class:"fb-album-thumb","data-src":s.source,src:""});a.append(d),t(d).load(function(){t(this).fadeIn(300)}),f(d),p()}else a.remove()}}),h.append(t("<div>",{class:"fb-album-title",text:t(e.data).get(a).name})),n.showImageCount&&h.append(t("<div>",{class:"fb-album-count",text:t(e.data).get(a).count})),t(v).append(h),t(v).removeClass("fb-loading-image"),n.albumsPageSize>0&&t(v).find("li").index(h)>=n.albumsPageSize&&(h.hide(),t(b).find(".fb-albums-more").fadeIn()),t(h).click(function(){var e=t(this);t(o).append(t("<div>",{class:"fb-album-preview"})),t(o).find("div.fb-albums-more").hide();var a=o.find(".fb-album-preview");a.append(t("<img>",{alt:"",height:32,width:32,src:n.pluginImagesPath+"back.png",class:"fb-albums-list"})),t(a).append(t("<ul>",{class:"fb-photos",style:"min-height:"+n.thumbnailSize+"px !important"})),photosContainer=t(a).find("ul.fb-photos");var i=s+t(e).attr("data-id")+"/photos";""!=n.accessToken&&(i+="?access_token="+n.accessToken+d),null!=n.albumSelected&&"function"==typeof n.albumSelected&&n.albumSelected({id:t(e).attr("data-id"),url:i,thumb:t(e).find("img.fb-album-thumb").attr("src")}),r(i,photosContainer),t(o).find("ul.fb-albums").fadeOut(function(){a.fadeIn()})}),t(h).hover(function(){var e=t(this),a=e.find("div.fb-album-title").height();e.find("div.fb-album-title").slideDown({duration:300,easing:"linear"}),e.find("div.fb-album-count").css({top:a+10+"px"})},function(){var e=t(this);e.find("div.fb-album-title").slideUp({duration:300,easing:"linear"}),e.find("div.fb-album-count").css({top:"0"})})}}e.paging&&e.paging.next&&""!=e.paging.next&&l(e.paging.next)}}})}function r(e,s){t(s).addClass("fb-loading-image");var c=s.parent();if(s.hasClass("fb-album-container")&&(c=s),0==c.find(".fb-photo").length){var l=c.find("img.fb-albums-list"),p=t("<h3>",{class:"fb-album-heading",text:""});l.length>0?l.after(p):(l=c.find(".fb-account-info")).length>0?(l.after(p),p.addClass("fb-album-heading-single")):c.prepend(p),null==n.onlyAlbum&&c.find("img.fb-albums-list,h3.fb-album-heading").click(function(){c.fadeOut(function(){t(o).find(".fb-albums").fadeIn(function(){n.albumsPageSize>0&&t(o).find("li.fb-album:hidden").length>0&&t(o).find("div.fb-albums-more").show()}),c.remove()})}),n.showAlbumNameInPreview&&t.ajax({type:"GET",url:e.replace("/photos","/").replace(d,"&fields=name"),cache:!1,dataType:"jsonp",success:function(t){null!=t&&c.find(".fb-album-heading").text(t.name)}})}t.ajax({type:"GET",url:e,cache:!1,dataType:"jsonp",success:function(e){if(e.data.length>0){if(n.showComments,null!=n.photosPageSize&&n.photosPageSize>0){var o=t(s).parent().find(".fb-btn-more");0==o.length&&n.showMoreButton&&(o=t("<div>",{class:"fb-btn-more fb-photos-more",lang:"cz",text:n.photosMoreButtonText}),t(s).parent().append(o),t(o).click(function(){var e=t(this);t(s).find("li.fb-photo:hidden").slice(0,n.photosPageSize).fadeIn(function(){0==t(s).find("li.fb-photo:hidden").length&&e.fadeOut(function(){e.remove()})})}))}for(a=0;a<e.data.length;a++){var d=t("<li>",{class:"fb-photo",style:"height:"+n.thumbnailSize+"px !important; width:"+n.thumbnailSize+"px !important"}),c=d.width(),l=d.height(),p=t(e.data)[a].images[0];for(i=0;i<t(e.data)[a].images.length;i++)t(e.data)[a].images[i].height>=l&&t(e.data)[a].images[i].width>=c&&t(e.data)[a].images[i].height<=p.height&&t(e.data)[a].images[i].width<=p.width&&(p=t(e.data)[a].images[i]);var b=t("<a>",{class:"fb-photo-thumb-link",href:t(e.data)[a].source,"data-fb-page":t(e.data)[a].link});if(c>0&&(c-p.width)/2,n.photosCheckbox){var g=t("<div>",{class:"image-check"});g.click(function(){var e={id:t(this).parent().find("img.fb-photo-thumb").attr("data-id"),url:t(this).parent().find("a").attr("href"),thumb:t(this).parent().find("img.fb-photo-thumb").attr("src")};if(t(this).toggleClass("checked"),t(this).hasClass("checked"))null!=n.photoChecked&&"function"==typeof n.photoChecked&&(n.checkedPhotos.push(e),n.photoChecked(e));else if(null!=n.photoUnchecked&&"function"==typeof n.photoUnchecked)for(i=0;i<n.checkedPhotos.length;i++)if(n.checkedPhotos[i].id==e.id){n.checkedPhotos.splice(i,1),n.photoUnchecked(e);break}return!1})}var v=t("<img>",{style:"margin: auto;position: absolute;top: 0; left: 0; bottom: 0; right: 0;display:none;","data-id":t(e.data).get(a).id,class:"fb-photo-thumb","data-src":p.source,src:""}),k=t("<span>",{class:"fb-photo-text"});if(k.text(t(e.data).get(a).name),b.append(k),b.append(v),n.photosCheckbox)for(d.append(g),i=0;i<n.checkedPhotos.length;i++)if(n.checkedPhotos[i].id==t(e.data).get(a).id){g.addClass("checked");break}d.append(b),s.append(d),t(s).removeClass("fb-loading-image"),n.photosPageSize>0&&t(s).find("li").index(d)>=n.photosPageSize&&(d.hide(),t(s).find(".fb-photos-more").fadeIn()),t(v).load(function(){t(this).fadeIn(300)}),f(v),function(e){var a=t(".fb-preview-overlay");if(0==a.length){a=t("<div>",{class:"fb-preview-overlay"});var i=t("<div>",{class:"fb-preview-content"});a.append(i),i.append(t("<img>",{class:"fb-preview-img"})),(n.showImageText||n.likeButton||n.shareButton)&&i.append(t("<div>",{class:"fb-preview-text"})),a.append(t("<img>",{class:"fb-preview-img-prev",src:n.pluginImagesPath+"prev-icon.png"})),a.append(t("<img>",{class:"fb-preview-img-next",src:n.pluginImagesPath+"next-icon.png"})),t("body").append(a),a=t(".fb-preview-overlay"),t(a).click(function(){t(this).fadeOut()}),t(a).find(".fb-preview-img").click(function(){return t(this).parent().find("img.fb-preview-img-next").click(),!1}),n.likeButton&&(t("body").append("<div>",{id:"fb-root"}),function(t,e,a){var i,n=t.getElementsByTagName("script")[0];t.getElementById(a)||((i=t.createElement("script")).id=a,i.src="//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3&appId=775908159169504",n.parentNode.insertBefore(i,n))}(document,0,"facebook-jssdk"))}else a=t(".fb-preview-overlay");t(e).unbind("click"),t(e).click(function(e){var a=t(".fb-preview-text"),i=t(".fb-preview-content");i.hide(),n.showImageText&&a.html(m(t(this).find(".fb-photo-text").text())),u(a,t(this).attr("data-fb-page"));var o={id:t(this).find("img.fb-photo-thumb").attr("data-id"),url:t(this).attr("href"),thumb:t(this).find("img.fb-photo-thumb").attr("data-id")};if(null!=n.photoSelected&&"function"==typeof n.photoSelected&&n.photoSelected(o),n.lightbox){var s=t(".fb-preview-overlay"),d=s.find("img.fb-preview-img");return d.hide(),s.find("img.fb-preview-img-prev,img.fb-preview-img-next").hide(),d.attr("data-id",t(this).find("img.fb-photo-thumb").attr("data-id")),d.attr("src",t(this).attr("href")),/chrom(e|ium)/.test(navigator.userAgent.toLowerCase())&&t(d).show(),d.unbind("load"),d.load(function(){i.css("display","block"),""!=a.text().trim()||n.likeBtn?a.css("display","block"):a.hide(),a.css("maxWidth",t(this).width()-12),a.css("minWidth",t(this).width()-12),t(".fb-comment,.fb-comment-more").css("maxWidth",t(this).width()-12),t(this).show(),n.showComments&&h(t(this).attr("data-id"),t(this).parent(),null);var e=s.find("img.fb-preview-img-prev");e.show(),e.unbind("click"),e.click(function(){var e=t(this).parent().find(".fb-preview-content"),o=t(e).find(".fb-preview-img"),s=t("[href='"+o.attr("src")+"']");if(0!=s.length){var c=s.parent().prev(),l=null;0!=c.length?(l=c.find(".fb-photo-thumb-link"),d.attr("data-id",l.find("img.fb-photo-thumb").attr("data-id")),d.attr("src",l.attr("href"))):(l=s.parent().parent().find("li").last().find(".fb-photo-thumb-link"),d.attr("data-id",l.find("img.fb-photo-thumb").attr("data-id")),d.attr("src",l.attr("href"))),i.hide(),n.showImageText&&a.html(m(l.text())),u(a,l.attr("data-fb-page"))}return!1});var o=s.find("img.fb-preview-img-next");o.show(),o.unbind("click"),o.click(function(){var e=t(this).parent().find(".fb-preview-content"),o=t(e).find(".fb-preview-img"),s=t("[href='"+o.attr("src")+"']");if(0!=s.length){var c=s.parent().next(),l=null;0!=c.length?(l=c.find(".fb-photo-thumb-link"),d.attr("data-id",l.find("img.fb-photo-thumb").attr("data-id")),d.attr("src",l.attr("href"))):(l=s.parent().parent().find("li").first().find(".fb-photo-thumb-link"),d.attr("data-id",l.find("img.fb-photo-thumb").attr("data-id")),d.attr("src",l.attr("href"))),i.hide(),n.showImageText&&a.html(m(l.text())),u(a,l.attr("data-fb-page"))}return!1}),t(document).unbind("keypress"),t(document).keypress(function(a){var i=a.keyCode?a.keyCode:a.which;switch(i){case 37:a.preventDefault(),t(e).click();break;case 39:a.preventDefault(),t(o).click();break;case 27:a.preventDefault(),t(s).click()}}),t(this).fadeIn()}),s.fadeIn(),e.preventDefault(),e.stopPropagation(),!1}})}(s.find("a.fb-photo-thumb-link"))}e.paging&&e.paging.next&&""!=e.paging.next&&r(e.paging.next,s)}}})}function h(e,a,i){var o=s+e+"/comments?access_token="+n.accessToken+"&limit="+n.commentsLimit;null!=i?o=i:(t(a).find(".fb-comment").remove(),t(a).find(".fb-comment-more").remove()),t.ajax({type:"GET",url:o,cache:!1,dataType:"jsonp",success:function(n){if(n.data.length>0){if(""!=n.paging.next){var o=t(a).find(".fb-comment-more");0==o.length&&(o=t("<div/>",{class:"fb-comment-more",text:"more"}),t(a).append(o)),t(o).unbind("click"),t(o).attr("data-next",n.paging.next),t(o).click(function(){return h(e,a,t(this).attr("data-next")),!1})}else t(a).find(".fb-comment-more").remove();for(t(o).css("maxWidth",a.find(".fb-preview-img").width()-12),c=0;c<n.data.length;c++){var d=s+t(n.data)[c].from.id+"/picture?type=square",l=t("<div/>",{class:"fb-comment"});l.css("maxWidth",a.find(".fb-preview-img").width()-12),l.append(t("<img/>",{src:d,class:"fb-comment-account"}));var r=t("<div/>",{class:"fb-comment-text"});r.append(t("<a/>",{class:"fb-comment-account",target:"_blank",href:"http://facebook.com/"+t(n.data)[c].from.id,text:t(n.data)[c].from.name})),r.append(t("<div/>",{class:"fb-comment-date",text:function(t){var e=t.split("T")[0],a=t.split("T")[1].substring(0,8);return new Date(Date.UTC(e.split("-")[0],e.split("-")[1],e.split("-")[2],a.split(":")[0],a.split(":")[1],a.split(":")[2]))}(t(n.data)[c].created_time).toLocaleString()})),r.append(t("<div/>",{text:t(n.data)[c].message})),l.append(r),o.before(l)}null==i?t(document).scrollTop():t(".fb-preview-overlay").animate({scrollTop:t(a).find(".fb-comment").last().offset().top},1e3)}}})}function f(e){var a=null;return t(e).hasClass("fb-photo-thumb")?a=t(e).parent().parent():t(e).hasClass("fb-album-thumb")&&(a=t(e).parent()),null==a||!(!function(e){var a=t(e),i=t(window),n=i.scrollTop()+i.height(),o=a.offset().top;a.height();return o<=n}(t(a))||""!=t(e).attr("src"))&&(t(e).attr("src",t(e).attr("data-src")),t(e).removeAttr("data-src"),!0)}function p(){t(window).scroll(function(){t(".fb-album-thumb[src='']").each(function(){return f(t(this))}),t(".fb-photo-thumb[src='']").each(function(){return f(t(this))})})}function u(e,a){if(n.likeButton){var i=t("<div>",{"data-show-faces":"false",class:"fb-like","data-href":a,"data-action":"like","data-layout":"box_count","data-share":n.shareButton,"data-show-faces":"false"}),o=t("<div>",{class:"fb-like-container"});o.append(i),e.prepend(o),FB.XFBML.parse()}if(n.shareButton&&null!=n.addThis&&""!=n.addThis){var s=t("<div>",{"data-url":a,class:"addthis_toolbox addthis_default_style"});for(btn=1;btn<=4;btn++)s.append(t("<a>",{class:"addthis_button_preferred_"+btn}));s.append(t("<a>",{class:"addthis_button_compact"})),s.append(t("<a>",{class:"addthis_counter addthis_bubble_style"})),e.append(s),"undefined"==typeof addthis?t.getScript("//s7.addthis.com/js/300/addthis_widget.js#pubid="+n.addThis,function(){addthis.update("share","url",a),addthis.toolbox(".addthis_toolbox")}):(addthis.update("share","url",a),addthis.toolbox(".addthis_toolbox"))}}function m(t){return t.replace(/(https?:\/\/([-\w\.]+)+(:\d+)?(\/([\w\/_\.]*(\?\S+)?)?)?)/gi,"<a href='$1' target='_blank'>$1</a>")}var b=o.get(e),g="";n.showAccountInfo&&function(e){var a=t("<div>",{class:"fb-account-info"}),i=t("<a>",{target:"_blank",href:""});a.append(i),i.append(t("<img>",{src:s+n.account+"/picture?type=square"})),i.append(t("<h3>",{class:"fb-account-heading"})),t(e).append(a);var o=s+n.account;""!=n.accessToken&&(o+="?access_token="+n.accessToken),t.ajax({type:"GET",url:o,cache:!1,dataType:"jsonp",success:function(a){t(e).find(".fb-account-info").find(".fb-account-heading").text(a.name),t(e).find(".fb-account-info").find("a").attr("href","http://facebook.com/"+(a.username?a.username:a.id))}})}(b),null==n.onlyAlbum?(t(b).append(t("<ul>",{class:"fb-albums",style:"min-height:"+n.thumbnailSize+"px !important"})),g=s+n.account+"/albums",""!=n.accessToken&&(g+="?access_token="+n.accessToken+"&fields=id,count,cover_photo,created_time,from,link,name,type,updated_time")):(g=s+n.onlyAlbum+"/photos",""!=n.accessToken&&(g+="?access_token="+n.accessToken+d));var v=t(b).find(".fb-albums");null!=n.onlyAlbum?(r(g,t(b)),p()):l(g)}),this}}(jQuery);